generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            BigInt     @id @default(autoincrement())
  email         String      @unique
  passwordHash  String
  resetToken    String?     @unique
  resetExpires  DateTime?
  createdAt     DateTime    @default(now())

  receipts      CustomerReceipt[]
}

model CustomerReceipt {
  id                      BigInt   @id @default(autoincrement())
  permitNo                String   @default("DEF/RD/6000")
  serialNumber            String   @unique
  receiptDate             DateTime
  customerName            String?
  nicPassport             String?
  sourceOfForeignCurrency String?
  remarks                 String?
  createdAt               DateTime @default(now())
  
  createdById             BigInt?
  createdBy               User?      @relation(fields: [createdById], references: [id])

  currencies              CustomerReceiptCurrency[]
  pdfs                    ReceiptPDF[]
 
}

model CustomerReceiptCurrency {
  id             BigInt   @id @default(autoincrement())
  receipt         CustomerReceipt @relation(fields: [receiptId], references: [id])
  receiptId       BigInt
  currencyType    String
  amountFcy       Decimal  @db.Decimal(18,4) @default(0)
  rateOffered     Decimal  @db.Decimal(18,6) @default(0)
  amountIssuedLkr Decimal  @db.Decimal(18,2) @default(0)
}

model ReceiptPDF {
  id          BigInt   @id @default(autoincrement())
  receiptId   BigInt   @unique
  fileName    String
  filePath    String
  createdAt   DateTime 
  
  receipt     CustomerReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)
}

model DailyCurrencyBalance {
  id             BigInt   @id @default(autoincrement())
  currencyType   String
  date           DateTime
  openingBalance Decimal  @db.Decimal(18,4) @default(0)
  purchases      Decimal  @db.Decimal(18,4) @default(0)
  exchangeBuy    Decimal  @db.Decimal(18,4) @default(0)
  exchangeSell   Decimal  @db.Decimal(18,4) @default(0)
  sales          Decimal  @db.Decimal(18,4) @default(0)
  deposits       Decimal  @db.Decimal(18,4) @default(0)
  closingBalance Decimal  @db.Decimal(18,4) @default(0)

  @@unique([currencyType, date])
}


model DepositRecord {
  id             BigInt  @id @default(autoincrement())
  currencyType   String
  amount         Decimal @db.Decimal(18,4)
  date           DateTime
  createdAt      DateTime @default(now())

  @@index([currencyType, date])  
}

